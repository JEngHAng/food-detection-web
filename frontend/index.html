<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Food Detection</title>
    <style>
      body {
        font-family: sans-serif;
        background-color: #f5f5f5;
        text-align: center;
        padding: 30px;
      }

      h1 {
        color: #2b6cb0;
      }

      .container {
        margin-top: 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
        display: inline-block;
      }

      #result-image {
        max-width: 500px;
        margin-top: 15px;
        border-radius: 10px;
      }

      #results-list {
        margin-top: 20px;
        text-align: left;
        font-size: 16px;
        color: #333;
        background: #edf2f7;
        padding: 10px;
        border-radius: 8px;
      }

      button {
        background-color: #3182ce;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        margin: 10px;
      }

      button:hover {
        background-color: #2b6cb0;
      }
    </style>
  </head>

  <body>
    <h1>üç± Food Detection (YOLOv8)</h1>

    <div class="container">
      <input type="file" id="upload" accept="image/*" />
      <button onclick="detect()">üîç Detect Food</button>

      <div>
        <img id="result-image" src="" alt="Result" />
      </div>

      <h3>üßæ Detection Results</h3>
      <div id="results-list">No detections yet.</div>
    </div>

    <script>
      async function detect() {
        const fileInput = document.getElementById("upload");
        if (!fileInput.files[0]) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö");
          return;
        }

        const formData = new FormData();
        formData.append("file", fileInput.files[0]);
        document.getElementById("results-list").innerHTML = "‚è≥ Detecting...";

        try {
          const response = await fetch("https://food-detection-web-demo.onrender.com/detect", {
            method: "POST",
            body: formData,
          });

          const data = await response.json();

          // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤ backend ‡∏™‡πà‡∏á error ‡∏°‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
          if (data.error) {
            document.getElementById("results-list").innerHTML =
              "‚ùå " + data.error;
            return;
          }

          if (!data.detections) {
            document.getElementById("results-list").innerHTML =
              "‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö";
            return;
          }

          // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏†‡∏≤‡∏û
          document.getElementById("result-image").src =
            "data:image/jpeg;base64," + data.image;

          // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö
          const resultsDiv = document.getElementById("results-list");
          if (data.detections.length === 0) {
            resultsDiv.innerHTML = "No objects detected.";
          } else {
            resultsDiv.innerHTML = data.detections
              .map(
                (d) =>
                  `<div>${d.class_name} (${(d.confidence * 100).toFixed(
                    1
                  )}%)</div>`
              )
              .join("");
          }
        } catch (err) {
          document.getElementById("results-list").innerHTML =
            "‚ùå Error: " + err.message;
        }
      }
    </script>
  </body>
</html>
