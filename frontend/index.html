<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Food Detection</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex flex-col items-center p-6">
  <h1 class="text-3xl font-bold text-blue-600 mb-6">üç± Food Detection Demo</h1>

  <div class="bg-white p-6 rounded-2xl shadow-lg w-full max-w-2xl text-center">
    <input id="imageUpload" type="file" accept="image/*"
      class="mb-4 block w-full text-sm text-gray-700 border border-gray-300 rounded-lg cursor-pointer focus:outline-none" />
    
    <img id="preview" class="hidden w-full max-h-96 object-contain rounded-xl mb-4 border" />

    <button id="detectBtn"
      class="bg-blue-500 text-white font-semibold px-6 py-2 rounded-xl hover:bg-blue-600 transition">Detect</button>

    <button id="resetBtn"
      class="hidden bg-gray-400 text-white font-semibold px-6 py-2 rounded-xl hover:bg-gray-500 ml-2 transition">Reset</button>

    <div id="result" class="mt-6 text-left hidden">
      <h2 class="text-lg font-semibold">üçΩ Detected Menus:</h2>
      <ul id="menuList" class="list-disc pl-5 mt-2 text-blue-600"></ul>

      <h2 class="text-lg font-semibold mt-4">üîç Components:</h2>
      <ul id="componentList" class="list-disc pl-5 mt-2 text-gray-700"></ul>

      <img id="detectedImage" class="hidden w-full mt-4 rounded-xl border" />
    </div>
  </div>

  <script>
    const imageUpload = document.getElementById("imageUpload");
    const preview = document.getElementById("preview");
    const detectBtn = document.getElementById("detectBtn");
    const resetBtn = document.getElementById("resetBtn");
    const result = document.getElementById("result");
    const menuList = document.getElementById("menuList");
    const componentList = document.getElementById("componentList");
    const detectedImage = document.getElementById("detectedImage");

    let uploadedFile = null;

    imageUpload.addEventListener("change", (event) => {
      const file = event.target.files[0];
      if (file) {
        uploadedFile = file;
        const reader = new FileReader();
        reader.onload = (e) => {
          preview.src = e.target.result;
          preview.classList.remove("hidden");
          resetBtn.classList.remove("hidden");
        };
        reader.readAsDataURL(file);
      }
    });

    detectBtn.addEventListener("click", async () => {
      if (!uploadedFile) return alert("Please upload an image first.");

      const formData = new FormData();
      formData.append("file", uploadedFile);

      result.classList.add("hidden");
      menuList.innerHTML = "";
      componentList.innerHTML = "";
      detectedImage.classList.add("hidden");

      // ‚úÖ ‡πÅ‡∏Å‡πâ URL ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å /detect
      const res = await fetch("https://biogeographically-caliphal-kaidence.ngrok-free.dev/detect", {
        method: "POST",
        body: formData
      });

      const data = await res.json();

      // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏°‡∏ô‡∏π
      if (!data.predicted_menus || data.predicted_menus.length === 0) {
        menuList.innerHTML = `<li class="text-red-500 font-medium">No matching menu</li>`;
      } else {
        data.predicted_menus.forEach(m => {
          const li = document.createElement("li");
          li.textContent = m;
          menuList.appendChild(li);
        });
      }

      // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à components
      if (data.detections && data.detections.length > 0) {
        data.detections.forEach(c => {
          const li = document.createElement("li");
          li.textContent = `${c.name} (${c.confidence}%)`;
          componentList.appendChild(li);
        });
      }

      // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß
      if (data.image) {
        detectedImage.src = "data:image/jpeg;base64," + data.image;
        detectedImage.classList.remove("hidden");
      }

      result.classList.remove("hidden");
    });

    resetBtn.addEventListener("click", () => {
      imageUpload.value = "";
      preview.src = "";
      preview.classList.add("hidden");
      result.classList.add("hidden");
      menuList.innerHTML = "";
      componentList.innerHTML = "";
      detectedImage.src = "";
      detectedImage.classList.add("hidden");
      uploadedFile = null;
    });
  </script>
</body>
</html>
