<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Food Detection AI üçõ</title>
    <style>
      body {
        font-family: "Prompt", sans-serif;
        background-color: #f4f6f9;
        text-align: center;
        padding: 30px;
      }

      h1 {
        color: #333;
      }

      #upload {
        margin-top: 20px;
      }

      button {
        margin-top: 20px;
        padding: 10px 20px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: background 0.3s;
      }

      button:hover {
        background-color: #45a049;
      }

      #result-box {
        margin-top: 30px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        padding: 20px;
        display: inline-block;
        min-width: 300px;
        max-width: 700px;
      }

      #result-image {
        margin-top: 15px;
        max-width: 100%;
        border-radius: 10px;
      }

      #results-list {
        text-align: left;
        margin-top: 15px;
        line-height: 1.6;
        color: #333;
      }
    </style>
  </head>
  <body>
    <h1>üç± ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÑ‡∏ó‡∏¢ (Thai Food Detection)</h1>

    <input type="file" id="upload" accept="image/*" />
    <br />
    <button onclick="detect()">‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>

    <div id="result-box">
      <h2>üîç ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö</h2>
      <img id="result-image" src="" alt="" />
      <div id="results-list">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</div>
    </div>

    <script>
      async function detect() {
        const fileInput = document.getElementById("upload");
        if (!fileInput.files[0]) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö");
          return;
        }

        const formData = new FormData();
        formData.append("file", fileInput.files[0]);
        document.getElementById("results-list").innerHTML = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö...";

        try {
          const response = await fetch(
            "https://biogeographically-caliphal-kaidence.ngrok-free.dev/detect",
            {
              method: "POST",
              body: formData,
            }
          );

          const data = await response.json();

          // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤ backend ‡∏™‡πà‡∏á error ‡∏°‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
          if (data.error) {
            document.getElementById("results-list").innerHTML =
              "‚ùå " + data.error;
            return;
          }

          if (!data.detections && !data.components) {
            document.getElementById("results-list").innerHTML =
              "‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö";
            return;
          }

          // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß
          document.getElementById("result-image").src =
            "data:image/jpeg;base64," + data.image;

          // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏ö‡∏ö‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°
          let html = "";

          if (data.predicted_menu && data.predicted_menu !== "‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á") {
            html += `<h3>üçõ ${data.predicted_menu}</h3>`;
            html += "<strong>üîç ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö:</strong><br>";

            (data.components || []).forEach((comp) => {
              html += `‚Ä¢ ${comp.name} (${comp.confidence?.toFixed(1) ?? 0}%)<br>`;
            });
          } else {
            html += "<h3>üçΩ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á</h3>";
            html += "<strong>üîç ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö:</strong><br>";

            (data.detections || []).forEach((det) => {
              html += `‚Ä¢ ${det.name} (${det.confidence?.toFixed(1) ?? 0}%)<br>`;
            });
          }

          document.getElementById("results-list").innerHTML = html;
        } catch (err) {
          document.getElementById("results-list").innerHTML =
            "‚ùå Error: " + err.message;
        }
      }
    </script>
  </body>
</html>
